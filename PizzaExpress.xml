<?xml version="1.0" encoding="UTF-8"?> 
<vxml version="2.0" xmlns="http://www.w3.org/2001/vxml" xml:lang="en-US"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
  xsi:schemaLocation="http://www.w3.org/2001/vxml 
   http://www.w3.org/TR/voicexml20/vxml.xsd">

<!-- <meta name="maintainer" content="jeff_heath@sil.org"/> -->

<!-- Welcome Form -->
<form id="frm_welcome">
  <block>
    <prompt bargein="false">
      <break time="1000ms" />
      Welcome to Pizza iks-press.
    </prompt>
    <goto next="#frm_main" />
  </block>
</form>

<form id="frm_main">
  <var name="confirmed"/>
  
  <grammar src="PizzaExpress-grammar.xml" root="define_mixed" />
  
  <!-- define the responses to no input (silence) -->
  <catch event="noinput"> 
    <prompt>Sorry, I can't hear you.</prompt>
    <reprompt/>
  </catch>
  <catch event="noinput" count="5"> 
    <prompt>Sorry, I'm not hearing you. Please call back later.</prompt>
    <exit/>
  </catch>
  
  <initial name="initial_request">
    <prompt> How may I help you. </prompt>
    
    <catch event="nomatch"> 
      <prompt>I didn't catch that. You can say something like "I'd like to order a large sausage pizza."</prompt>
    </catch>
    <catch event="nomatch" count="2"> 
      <prompt>Sorry, I'm still not catching it. Please speak clearly, and just say the minimum, like "large sausage pizza".</prompt>
    </catch>
    <catch event="nomatch" count="3"> 
      <prompt>Sorry, I'm still not catching it. Let me direct you to our menu system.</prompt>
      <!-- go to a different system??? -->
      <assign name="initial_request" expr="true"/>
    </catch>
  </initial>
  
  <field name="Cmd">
    <!-- only reason to get here is multiple nomatch conditions -->
    <prompt> Please say "order" or "hours". </prompt>
<!--    <grammar src="PizzaExpress-grammar.xml" root="get_cmd" /> -->
  
    <catch event="nomatch"> 
      <prompt>I didn't catch that.</prompt> <reprompt />
    </catch>
    <catch event="nomatch" count="3"> 
      <prompt>I'm not following you. Please call back later.</prompt>
      <exit/>
    </catch>
  </field>
  
  <field name="Order">
    <block>
      <assign name="Order" expr="None" />
    </block>
  </field>
  
  <filled namelist="Cmd">
    <!-- process the command -->
    <log>Jeff: Cmd is <value expr="Cmd"/></log>
    <log>Jeff: Order is <value expr="Order"/></log>
    <if cond="Cmd=='Hours'">
      <prompt> We are open 10 a m to 9 p m Monday through Saturday. </prompt>
    <elseif cond="Cmd=='Order'" />
      <!-- check if the order is complete -->
      
      <prompt>
        Great! We'll get your <value expr="Order.Item"/> on the way!
      </prompt>
    <else />
      <prompt> Invalid command. </prompt>
    </if>
    <prompt> Thanks for your business! </prompt>
    <exit/>
  </filled>

  <!--
  <field name="cmd"> </field>
  <field name="item"> </field>
  <field name="phone_number" type="phone" cond="cmd == 'order'">
    <prompt> What's your phone number? </prompt>
    <help> Please say your ten digit phone number. </help>
  </field>
  
  <field name="delivery" type="boolean" cond="cmd == 'order'">
    <prompt> Would you like your order delivered? </prompt>
    <help> Would you like your order delivered? Say yes or no. </help>
  </field>
  
  <record name="address" maxtime="10s"
    finalsilence="2000ms" dtmfterm="true" type="audio/x-wav"
    cond="cmd == 'order' &amp;&amp; delivery == yes" >
    <prompt timeout="5s">
      What address should we deliver to?
    </prompt>
    <noinput>
      Please say your address.
    </noinput>
  </record>
  
  <field name="confirm">
    <grammar type="application/srgs+xml" src="/grammars/boolean.grxml"/>
    <prompt>
      You would like your order delivered to <audio expr="address"/>.
      Is this correct?
    </prompt>
    <filled>
      <if cond="confirm">
        <submit next="save_message.pl" enctype="multipart/form-data"
           method="post" namelist="address"/>
      </if>
      <clear/>
    </filled>
  </field>
  -->
<!--
  <subdialog name="get_order_confirmation" src="./confirm.xml#getconfirmation">
    <param name="confirm_prompt" expr="'Would you like to order a pizza?'"/>
    <filled>
      <assign name="confirmed" expr="get_order_confirmation.confirmation"/>
    </filled>
  </subdialog>
  
  <block>
    <log>Jeff: Confirmed is <value expr="confirmed"/></log>
    <if cond="confirmed == 'no'">
      Okay, let's start over.
      <clear namelist="initial_request confirmed"/>
    </if>
  </block>
-->
  
</form>
</vxml>